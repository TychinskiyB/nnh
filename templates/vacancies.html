{% extends "base.html" %}
{% block title %}–í–∞–∫–∞–Ω—Å–∏–∏ ‚Äî –ù–û–í–û–ù–ï–§–¢–ï–•–ò–ú{% endblock %}


{% block head_extra %}
<style>
/* ===== APPLE-STYLE VARIABLES ===== */
:root {
 --apple-card-bg: #ffffff;
 --apple-card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
 --apple-card-hover: 0 8px 32px rgba(0, 0, 0, 0.12);
 --apple-border: 1px solid rgba(0, 0, 0, 0.08);
 --apple-border-strong: 1px solid rgba(0, 0, 0, 0.12);
 --apple-radius: 12px;
 --apple-radius-large: 20px;
 --apple-transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);


 /* –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç –≤ —Å—Ç–∏–ª–µ Apple (–≤–º–µ—Å—Ç–æ —Å–∏–Ω–µ–≥–æ) */
 --apple-accent-bg: #e5e5ea;
 --apple-accent-ink: #1c1c1e;
 --apple-accent-shadow: 0 2px 8px rgba(0,0,0,.12);
}


/* ===== TOOLBAR APPLE STYLE ===== */
.vac-toolbar {
 display: flex; gap: 16px; flex-wrap: wrap; align-items: center; justify-content: space-between;
 margin-bottom: 32px; padding-bottom: 16px; border-bottom: var(--apple-border);
}
.vac-filters { display: flex; gap: 8px; flex-wrap: wrap; }
.vac-filters .btn {
 padding: 10px 20px; border-radius: 20px; border: var(--apple-border);
 background: var(--light-gray); font-size: 15px; font-weight: 500; color: var(--ink);
 transition: var(--apple-transition); backdrop-filter: blur(10px);
}
.vac-filters .btn:hover { background: rgba(0, 0, 0, 0.03); transform: translateY(-1px); border-color: rgba(0, 0, 0, 0.15); }
.vac-filters .btn[aria-pressed="true"] {
 background: var(--apple-accent-bg); color: var(--apple-accent-ink);
 border-color: rgba(0,0,0,0.12); box-shadow: var(--apple-accent-shadow);
}


/* –ü–æ–∏—Å–∫ */
.vac-search { display: flex; align-items: center; min-width: 280px; flex: 1; max-width: 400px; margin-left: auto; position: relative; }
.vac-search::before { content: "üîç"; position: absolute; left: 16px; z-index: 2; opacity: .5; font-size: 14px; }
.vac-search .input {
 width: 100%; padding: 12px 16px 12px 44px; border-radius: 20px; border: var(--apple-border);
 background: var(--apple-card-bg); font-size: 15px; transition: var(--apple-transition); backdrop-filter: blur(10px);
}
.vac-search .input:focus { outline: none; border-color: rgba(0,0,0,0.2); box-shadow: 0 0 0 3px rgba(0,0,0,0.06); }


/* ===== GRID & CARDS ===== */
.vac-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px; margin-bottom: 40px; }
.vac-card {
  cursor: pointer; transition: var(--apple-transition); border: var(--apple-border);
  border-radius: var(--apple-radius-large); background: var(--apple-card-bg);
  overflow: hidden; position: relative; backdrop-filter: blur(10px);
}
.vac-card::before {
  content: ""; position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(0,0,0,0.15), transparent); opacity: 0; transition: var(--apple-transition);
}
.vac-card:hover { transform: translateY(-4px); box-shadow: var(--apple-card-hover); border-color: rgba(0,0,0,0.12); }
.vac-card:hover::before { opacity: 1; }

/* --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ --- */
.vac-card .card-body { 
  display: flex; 
  flex-direction: column; 
  gap: 12px; 
  padding: 24px; 
  min-height: 140px;
}

/* –ë–µ–π–¥–∂ –≤–≤–µ—Ä—Ö—É */
.vac-card .badge { 
  align-self: flex-start; 
  margin-bottom: 4px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.vac-card h3{
 margin: 20px 0 0 0; /* –£–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø –¥–æ 12px */
 line-height: 1.3; 
 font-size: 20px; 
 font-weight: 600; 
 color: #1D1D1F; 
 letter-spacing: -0.2px;
 overflow-wrap: anywhere; 
 word-break: break-word;
}

/* –ó–∞—Ä–ø–ª–∞—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç—Å—Ç—É–ø–æ–º —Å–Ω–∏–∑—É */
.vac-card .meta{ 
  font-size: 17px; 
  color: #444c54; 
  font-weight: 500; 
  margin: 0;
  margin-top: auto; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏ */
}

/* –ë–µ–π–¥–∂–∏ */
.vac-card .badge{
  display: inline-flex; 
  align-items: center; 
  gap: 6px; 
  font-size: 13px; 
  font-weight: 600;
  border-radius: 14px; 
  padding: 6px 12px; 
  border: none; 
  color: #1c1c1e; 
  background: #f2f2f7;
}
.badge.dot::before{ content: ""; width: 8px; height: 8px; border-radius: 50%; }

/* –†–∞–∑–Ω—ã–µ —Å–ø–æ–∫–æ–π–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
.badge.office{ background: #f2f2f7; color: #1c1c1e; }
.badge.office.dot::before{ background: #8e8e93; }

.badge.plant{ background: #e9f9f0; color: #1c1c1e; }
.badge.plant.dot::before{ background: #8B7355; }
/* ===== EMPTY STATE ===== */
.vac-empty { text-align:center; color:var(--ink-muted); padding:60px 20px; font-size:18px; display:none; }
.vac-empty::before { content:"üíº"; font-size:48px; display:block; margin-bottom:16px; opacity:.5; }


/* ===== MODAL ===== */
.modal[hidden]{ display:none; }
.modal{ position:fixed; inset:0; z-index:1000; display:grid; place-items:center; padding:20px; animation:modalAppear .4s cubic-bezier(.23,1,.32,1); }
@keyframes modalAppear{ from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)} }
.modal-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.4); backdrop-filter:blur(8px); animation:backdropAppear .3s ease-out; }
@keyframes backdropAppear{ from{opacity:0} to{opacity:1} }
.modal-dialog{ position:relative; width:min(800px,100%); max-height:90vh; display:flex; }
.vac-modal .modal-content{
 background:var(--apple-card-bg); border-radius:var(--apple-radius-large); padding:32px; box-shadow:0 20px 60px rgba(0,0,0,.2);
 overflow:auto; max-height:90vh; border:var(--apple-border-strong); backdrop-filter:blur(20px); animation:contentSlide .3s ease-out;
}
@keyframes contentSlide{ from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:translateY(0)} }
.modal-close{
 position:absolute; top:20px; right:20px; width:36px; height:36px; border-radius:50%;
 border:var(--apple-border); background:var(--apple-card-bg); cursor:pointer; display:flex; align-items:center; justify-content:center;
 font-size:20px; color:var(--ink-muted); transition:var(--apple-transition); z-index:1;
}
.modal-close:hover{ background:rgba(0,0,0,.05); transform:rotate(90deg); }
.vac-modal h2{ margin:0 0 8px; font-size:32px; font-weight:700; color:#1D1D1F; letter-spacing:-0.5px; line-height:1.2; }
.vac-modal .muted{ color:#86868B; margin:0 0 24px; font-size:17px; }


/* Grid for details */
.vac-modal .grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:16px; margin:24px 0; }
.vac-modal .card{ border-radius:var(--apple-radius); border:var(--apple-border); background:rgba(0,0,0,.02); transition:var(--apple-transition); }
.vac-modal .card:hover{ background:rgba(0,0,0,.04); border-color:rgba(0,0,0,.12); }
.vac-modal .card-body{ padding:16px; font-size:15px; }
.vac-modal .card-body strong{ display:block; font-size:13px; color:#86868B; margin-bottom:4px; font-weight:600; text-transform:uppercase; letter-spacing:.5px; }
.vac-modal h3{ font-size:24px; font-weight:600; margin:32px 0 16px; color:#1D1D1F; letter-spacing:-.3px; }
.vac-modal p{ margin:0 0 20px; line-height:1.6; font-size:17px; color:#1D1D1F; }


/* ===== APPLY FORM ===== */
.apply-form{ margin-top:24px; }
.apply-form .input, .apply-form .textarea{
 border-radius:var(--apple-radius); padding:14px 16px; margin-top:8px; border:var(--apple-border);
 background:var(--apple-card-bg); font-size:16px; transition:var(--apple-transition); width:100%;
}
.apply-form .input:focus, .apply-form .textarea:focus{ outline:none; border-color:rgba(0,0,0,0.2); box-shadow:0 0 0 3px rgba(0,0,0,0.06); }
.apply-form button{
 margin-top:20px; width:100%; border-radius:var(--apple-radius); font-size:17px; font-weight:600; padding:16px;
 background:#1c1c1e; color:#fff; border:none; cursor:pointer; transition:var(--apple-transition);
}
.apply-form button:hover{ background:#2c2c2e; transform:translateY(-1px); }
.apply-form button:active{ transform:translateY(0); }


/* Responsive */
@media (max-width: 768px){
 .vac-toolbar{ flex-direction:column; align-items:stretch; }
 .vac-search{ margin-left:0; max-width:100%; }
 .vac-grid{ grid-template-columns:1fr; gap:16px; }
 .vac-modal .modal-content{ padding:24px; margin:20px; }
 .vac-modal .grid{ grid-template-columns:1fr; }
 .vac-modal h2{ font-size:28px; }
}


/* Section header */
.section-head h1{ font-size:48px; font-weight:700; letter-spacing:-1px; margin-bottom:8px; color:#1D1D1F; }
.section-head .muted{ font-size:17px; color:#86868B; margin-bottom:0; }
</style>
{% endblock %}


{% block content %}
<section class="section">
 <div class="container">
   <div class="section-head center">
     <h1>–í–∞–∫–∞–Ω—Å–∏–∏</h1>
     {% if addr_office and addr_plant %}
     <p class="muted">–û—Ñ–∏—Å: {{ addr_office }} ‚Ä¢ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: {{ addr_plant }}</p>
     {% endif %}
   </div>


   <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
   <div class="vac-toolbar">
     <div class="vac-filters" role="tablist" aria-label="–§–∏–ª—å—Ç—Ä –ª–æ–∫–∞—Ü–∏–π">
       <button class="btn" data-filter="all" aria-pressed="true">–í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</button>
       <button class="btn" data-filter="office" aria-pressed="false">–û—Ñ–∏—Å</button>
       <button class="btn" data-filter="plant" aria-pressed="false">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
     </div>
     <div class="vac-search">
       <input class="input" id="vacSearch" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏‚Ä¶">
     </div>
   </div>


   <div class="vac-grid" id="vacGrid">
  {% for v in items %}
  {% set loc_key = 'office' if v.location == 'office' else 'plant' %}
  <article class="card vac-card"
    data-id="{{ v.id }}"
    data-title="{{ v.title|e }}"
    data-salary="{{ (v.salary or '')|e }}"
    data-payperiod="{{ (v.pay_period or '')|e }}"
    data-exp="{{ (v.experience or '')|e }}"
    data-etype="{{ (v.employment_type or '')|e }}"
    data-schedule="{{ (v.schedule or '')|e }}"
    data-hours="{{ (v.work_hours or '')|e }}"
    data-format="{{ (v.work_format or '')|e }}"
    data-desc="{{ (v.description or '')|e }}"
    data-location="{{ v.location_human|e }}"
    data-loc-key="{{ loc_key }}">
    <div class="card-body">
      <!-- –ë–µ–π–¥–∂ –ü–ï–†–í–´–ú -->
      <span class="badge dot {{ loc_key }}">{{ '–û—Ñ–∏—Å' if loc_key=='office' else '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ' }}</span>
      <!-- –ó–∞—Ç–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <h3 class="vac-title">{{ v.title }}</h3>
      <!-- –ò –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π -->
      <div class="meta">{{ v.salary or '–ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏' }}</div>
    </div>
  </article>
  {% else %}
    <p class="muted" style="text-align: center; padding: 40px; font-size: 18px; color: #86868B;">
      –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π
    </p>
  {% endfor %}
</div>


   <div class="vac-empty" id="vacEmpty">–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –≤–∞–∫–∞–Ω—Å–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
 </div>
</section>


<!-- –ú–æ–¥–∞–ª–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ —Ñ–æ—Ä–º–æ–π –æ—Ç–∫–ª–∏–∫–∞ -->
<div class="modal vac-modal" id="vacModal" hidden aria-modal="true" role="dialog">
 <div class="modal-backdrop" data-close></div>
 <div class="modal-dialog">
   <div class="modal-content">
     <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-close>√ó</button>
     <h2 id="mTitle" class="mt-0"></h2>
     <p class="muted" id="mLoc"></p>


     <div class="grid">
       <div class="card"><div class="card-body"><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞</strong> <span id="mSalary"></span></div></div>
       <div class="card"><div class="card-body"><strong>–í—ã–ø–ª–∞—Ç—ã</strong> <span id="mPP"></span></div></div>
       <div class="card"><div class="card-body"><strong>–û–ø—ã—Ç</strong> <span id="mExp"></span></div></div>
       <div class="card"><div class="card-body"><strong>–ó–∞–Ω—è—Ç–æ—Å—Ç—å</strong> <span id="mET"></span></div></div>
       <div class="card"><div class="card-body"><strong>–ì—Ä–∞—Ñ–∏–∫</strong> <span id="mSch"></span></div></div>
       <div class="card"><div class="card-body"><strong>–ß–∞—Å—ã</strong> <span id="mHrs"></span></div></div>
       <div class="card"><div class="card-body"><strong>–§–æ—Ä–º–∞—Ç</strong> <span id="mFmt"></span></div></div>
     </div>


     <h3>–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h3>
     <p id="mDesc"></p>


     <hr style="border: none; height: 1px; background: var(--apple-border); margin: 32px 0;">


     <h3>–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</h3>
     <form id="applyForm" class="apply-form" method="POST">
       <input class="input" name="name" placeholder="–§–ò–û" required>
       <input class="input mt-1" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
       <textarea class="textarea mt-1" name="note" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="3"></textarea>
       <button class="btn btn-primary mt-1" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫</button>
     </form>
   </div>
 </div>
</div>
{% endblock %}


{% block body_end %}
<script>
(function(){
 const grid = document.getElementById('vacGrid');
 const cards = Array.from(grid.querySelectorAll('.vac-card'));
 const empty = document.getElementById('vacEmpty');


 const filterBtns = document.querySelectorAll('.vac-filters .btn');
 const searchInput = document.getElementById('vacSearch');


 let curFilter = 'all';
 let query = '';


 const normalize = s => (s||'').toLowerCase().trim();


 function applyFilters(){
   const q = normalize(query);
   let visibleCount = 0;


   cards.forEach(card=>{
     const loc = card.dataset.locKey;
     const title = normalize(card.querySelector('.vac-title')?.textContent);
     const passFilter = (curFilter === 'all') || (loc === curFilter);
     const passSearch = !q || title.includes(q);
     const show = passFilter && passSearch;
     card.style.display = show ? '' : 'none';
     if(show) visibleCount++;
   });


   empty.style.display = visibleCount ? 'none' : 'block';
 }


 filterBtns.forEach(btn=>{
   btn.addEventListener('click', ()=>{
     filterBtns.forEach(b=>b.setAttribute('aria-pressed','false'));
     btn.setAttribute('aria-pressed','true');
     curFilter = btn.dataset.filter;
     applyFilters();
   });
 });


 searchInput.addEventListener('input', (e)=>{
   query = e.target.value;
   applyFilters();
 });


 // –ú–æ–¥–∞–ª–∫–∞
 const modal = document.getElementById('vacModal');
 const fill = (id, v) => document.getElementById(id).textContent = v || '‚Äî';


 function openModal(card){
   document.getElementById('mTitle').textContent = card.dataset.title || '';
   fill('mLoc', card.dataset.location);
   fill('mSalary', card.dataset.salary || '–ü–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏');
   fill('mPP', card.dataset.payperiod);
   fill('mExp', card.dataset.exp);
   fill('mET', card.dataset.etype);
   fill('mSch', card.dataset.schedule);
   fill('mHrs', card.dataset.hours);
   fill('mFmt', card.dataset.format);
   fill('mDesc', card.dataset.desc);


   document.getElementById('applyForm').action = `/vacancies/${card.dataset.id}/apply`;


   modal.hidden = false;
   document.body.style.overflow = 'hidden';
   document.body.style.paddingRight = (window.innerWidth - document.documentElement.clientWidth) + 'px';
 }


 function closeModal(){
   modal.hidden = true;
   document.body.style.overflow = '';
   document.body.style.paddingRight = '';
 }


 cards.forEach(c=> c.addEventListener('click', ()=>openModal(c)));
 modal.addEventListener('click', (e)=>{ if(e.target.hasAttribute('data-close')) closeModal(); });
 window.addEventListener('keydown', (e)=>{ if(!modal.hidden && e.key==='Escape') closeModal(); });


 applyFilters();
})();
</script>
{% endblock %}





